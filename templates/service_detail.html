{% extends "jde_base.html" %}

{% load static %}

{% block title %}{{service.title}} {% endblock %}



{% block content %}
<!-- <section class="relative h-[300px] lg:h-[400px]">
    <div class="relative h-full w-full lg:w-3/4 mx-auto">
        <img src="{% static 'jde_assets' %}/{{service.image}}" class="object-cover h-full w-full block rounded-b-3xl" alt="">
        <div class="grid text-center items-center absolute left-0 top-0 h-full w-full">
            <div class="text-center font-black text-3xl lg:text-4xl text-white px-4 white-shadow tracking-wider">
                <p class="inline-block bg-black bg-opacity-60 p-2">{{service.title}} </p>
                
            </div>
        </div> 
    </div>

</section>-->



<div class="max-w-3xl mx-auto mt-10 bg-white shadow-md rounded-lg p-6">
    <p class="text-center text-4xl md:text-5xl font-extrabold pb-14">{{service.title}} </p>
    
    {% if not service.septemp %}
    <div class="rounded-xl bg-gradient-to-br from-lime-800 via-green-900 to-lime-800 p-4">
		<div class="text-white font-semibold text-lg md:text-xl">
			{{service.desc}}
		</div>
		
	</div>
    {% else %}
        {% include service.temp %}
    {% endif %}
        
	
</div>



<div class="max-w-3xl mx-auto mt-10 bg-white shadow-md rounded-lg p-6">
    <h1 class="text-lg md:text-xl font-medium mb-4">Please carefully provide all the required information in the form below, make the appropriate payment for the service fee (if required), and then submit your service request. </h1>

    <form id="translationForm" method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        
        {% if 'translation' in service.service_cat %}
        <div id="documents-container" class="space-y-4">
            <!-- First document upload block -->
            <div class="document-item flex flex-col sm:flex-row sm:items-center sm:space-x-4 p-4 border border-lime-200 rounded-lg bg-lime-50 ">
                <div class="flex-1">
                    <label class="block font-semibold mb-1">Document Type</label>
                    <select name="document_type" class="w-full border rounded p-2 bg-white">
                        <option value="">Select document type</option>
                        <option>Birth Certificate / Attestation of Birth</option>
                        <option>Spinster/Bachelorhood Certificate</option>
                        <option>Marriage Certificate</option>
                        <option>Divorce Certificate</option>
                        <option>Adoption Certificate</option>
                        <option>Police Character Certificate / Report</option>
                        <option>Legal Document</option>
                        <option>Court Affidavit</option>
                        <option>Transcript / Diploma</option>
                        <option>Driving License</option>
                    </select>
                </div>

                <div class="flex-1 mt-4 sm:mt-0">
                    <label class="block font-semibold mb-1">Upload Document File</label>
                    <input type="file" name="document_file" class="w-full border rounded p-2 bg-white">
                </div>
            </div>
        </div> 
        <!-- Add another document button -->
        <button type="button" id="addDocumentBtn"
            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
            + Add Another Document
        </button>
				{% else %}
				<div class="p-4 border rounded-lg bg-lime-50">
					<div class="space-y-4">
						<div>
            	<label class="block text-base md:text-lg font-semibold mb-1">Required Info 1</label>
							<input type="text" name="info-1" id="info-1" value="" class="p-2 inline-block w-full border border-gray-200 rounded-[4px]">							
						</div>
						<div>
            	<label class="block text-base md:text-lg font-semibold mb-1">Required Info 2</label>
							<input type="text" name="info-1" id="info-1" value="" class="p-2 inline-block w-full border border-gray-200 rounded-[4px]">							
						</div>
						<div>
            	<label class="block text-base md:text-lg font-semibold mb-1">Required Info 3</label>
							<input type="text" name="info-1" id="info-1" value="" class="p-2 inline-block w-full border border-gray-200 rounded-[4px]">							
						</div>
						
					</div>	
				</div>
        {% endif %}

        <!-- Display total fee -->
        <div class="mt-4">
            <p class="text-lg md:text-xl font-semibold text-amber-500">Service Fee Calculation:
						<span id="" class="text-green-600">{{service.fee_text}}</span>
            </p>
        </div>
        <input type="hidden" name="" id="fee-required" value="{% if service.payment_required %}true{% endif %}">

				{% if service.payment_required %}
        <div class="mt-4">
            <p class="text-lg md:text-xl font-semibold text-amber-500">Total Fee to pay:
						<span id="totalFee" class="text-green-600">€{{service.fee_amount}} </span>
            </p>
        </div>
				<input type="hidden" name="" id="fee-amount" value="{{service.fee_amount}}">
                

        <!-- Payment section -->
        <div class="mt-6 p-4 border rounded-lg bg-gray-50">
            <p class="font-medium md:text-lg flex items-center pb-2"><input type="checkbox" name="" id="terms-agree-check" class="inline-block w-5 h-5  accent-green-500 "> <span class="inline-block pl-4">I have read, understood and accepted the <button class="font-bold text-blue-600"><a href="{% url 'base:terms' %}">Terms & Conditions</a></button> of service.</span></p>
            <!-- <p class="mb-2 font-medium">Make Payment:</p> -->
            <button type="button" id="payBtn" disabled
                class="cursor-not-allowed bg-gray-400 text-white px-4 py-2 rounded">
                Pay Now
            </button>
            <p id="paymentStatus" class="text-sm text-red-600 mt-2">Payment not yet made.</p>
        </div>
				{% else %}
				<div class="mt-4 bg-amber-500 rounded-lg text-black font-semibold p-4">
					<p>Please note that after submitting your service request, we will calculate the total fee to be paid for the service and communicate with you on how to make the payment. We will begin the processing of the service requested after receiving your payment. </p>
				</div>
                <p class="font-medium md:text-lg flex items-center"><input type="checkbox" name="" id="terms-agree-check" class="inline-block w-5 h-5  accent-green-500 "> <span class="inline-block pl-4">I have read, understood and accepted the <button class="font-bold text-blue-600"><a href="{% url 'base:terms' %}">Terms & Conditions</a></button> of service.</span></p>
				{% endif %}

				<div class="mx-auto text-center py-4">
        <!-- Submit button (disabled until payment) -->
        <button type="submit" id="submitBtn"
            class="text-white px-6 py-2 rounded cursor-not-allowed bg-gray-400"
            {% if service.payment_required %}disabled{% endif %}>
            Submit Service Request
        </button>
					
				</div>
    </form>


<!-- Prompt to Login or Continue as Guest -->
<div id="login-prompt" class="hidden fixed inset-0 bg-black bg-opacity-75 items-center justify-center z-50">
  <div class="bg-white rounded-2xl w-4/5 md:w-3/5 lg:w-1/2 shadow-lg text-left">
    <div class="p-4 lg:p-6 font-semibold md:text-lg">
        You are currently accessing this website as a Guest. Would you like to login/register, or you prefer to continue as a guest ?
        <p class="pt-3 flex justify-center gap-3 md:gap-5">
            <button class="inline-block px-3 py-1 rounded-[4px] bg-green-600 text-white"><a href="{% url 'base:auth' %}?next={% url 'base:service-page' service.title|slugify %}">Login / Register</a></button>
            <button class="inline-block px-3 py-1 rounded-[4px] bg-green-600 text-white" id="cancel-prompt">Continue as Guest</button>
        </p>
    </div>
  </div>
</div>
<input type="hidden" name="" id="user-authenticated" value="{% if user.is_authenticated %}true{% endif %}">
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const promptDiv = document.getElementById("login-prompt");
        const userAuth = document.getElementById("user-authenticated").value;
        const cancelButton = document.getElementById("cancel-prompt");
        setTimeout(() => {
            if (userAuth == "true") {
                promptDiv.classList.remove("flex")
                promptDiv.classList.add("hidden")
            } else {
                promptDiv.classList.add("flex")
                promptDiv.classList.remove("hidden")
            }
        }, 3000)

        cancelButton.addEventListener("click", () => {
            promptDiv.classList.add("hidden");
        });
    })
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    
    const documentsContainer = document.getElementById("documents-container");
    const addDocumentBtn = document.getElementById("addDocumentBtn");
    const totalFeeEl = document.getElementById("totalFee");
    const payBtn = document.getElementById("payBtn");
    const paymentStatus = document.getElementById("paymentStatus");
    const submitBtn = document.getElementById("submitBtn");
    const feeRequired = document.getElementById("fee-required").value;
    const termsCheck = document.getElementById("terms-agree-check");

    termsCheck.addEventListener('input', () => {
        
        if (feeRequired == "true") {
            if (termsCheck.checked) {
                payBtn.disabled = false;
                payBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
                payBtn.classList.add("bg-green-500", "hover:bg-green-700");
            } else {
                payBtn.disabled = true;
                payBtn.classList.add("bg-gray-400", "cursor-not-allowed");
                payBtn.classList.remove("bg-green-500", "hover:bg-green-700");
            }
        } else {
            if (termsCheck.checked) {
                submitBtn.disabled = false;
                submitBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
                submitBtn.classList.add("bg-green-500", "hover:bg-green-700");
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add("bg-gray-400", "cursor-not-allowed");
                submitBtn.classList.remove("bg-green-500", "hover:bg-green-700");
            }
        }
        
        
    })

    function updateTotalFee() {
        const feePerDoc = parseInt(document.getElementById("fee-amount").value);
        const docCount = documentsContainer.querySelectorAll(".document-item").length;
        totalFeeEl.textContent = `€${docCount * feePerDoc}`;
    }


		function addRemoveButton(docBlock) {
        // Create remove button
        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.textContent = "×";
        removeBtn.className = "absolute top-0 right-4 text-red-500 hover:text-red-700 font-bold text-2xl";

        // Add click event to remove document block
        removeBtn.addEventListener("click", function () {
            docBlock.remove();
            updateTotalFee();
        });

        // Position the button inside the document block
        docBlock.classList.add("relative");
        docBlock.appendChild(removeBtn);
    }

    if (addDocumentBtn) addDocumentBtn.addEventListener("click", function () {
        const newDoc = documentsContainer.querySelector(".document-item").cloneNode(true);
        newDoc.querySelectorAll("input, select").forEach(input => {
            input.value = "";
        });
				addRemoveButton(newDoc);
        documentsContainer.appendChild(newDoc);
        updateTotalFee();
    });

    payBtn.addEventListener("click", function () {
        // Simulate successful payment
        
        paymentStatus.textContent = "Payment successful ✔";
        paymentStatus.classList.remove("text-red-600");
        paymentStatus.classList.add("text-green-600");

        submitBtn.disabled = false;
        submitBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
        submitBtn.classList.add("bg-green-500", "hover:bg-green-700");
        alert("Your payment for the service was successful. Thank you.")
    });

    updateTotalFee();
});
</script>
{% endblock %}

